# DateFeedBack タスク一覧

## 📋 概要

マッチングアプリ等で出会った異性とのデート会話を録音・分析し、フィードバックを提供する Flutter Web アプリケーションの実装タスクを整理します。MVC パターンと HooksRiverpod を採用し、段階的に機能を実装していきます。

## ✅ タスクリスト

### フェーズ 1: プロジェクトセットアップ

1. **プロジェクト初期化**

   - 概要: Flutter Web プロジェクトの作成と基本設定
   - 完了条件:
     - [ ] `flutter create`でプロジェクト作成
     - [ ] `pubspec.yaml`に必要なパッケージを追加
       - hooks_riverpod
       - firebase_core
       - firebase_auth
       - cloud_firestore
       - google_cloud_storage
     - [ ] Firebase/GCP プロジェクトの設定
     - [ ] GitHub リポジトリの設定
   - 動作確認:
     - [ ] `flutter pub get`が正常に完了
     - [ ] `flutter run -d chrome`でビルドが通ること
     - [ ] Firebase 接続確認
   - メモ: バージョン指定は`pubspec.yaml`で明示的に行う

2. **ディレクトリ構造の整備**
   - 概要: MVC パターンに基づくディレクトリ構造の作成
   - 完了条件:
     - [ ] 以下のディレクトリ構造を作成:
       ```
       lib/
       ├── auth/
       │   ├── models/
       │   ├── views/
       │   ├── controllers/
       │   └── providers/
       ├── upload/
       │   ├── models/
       │   ├── views/
       │   ├── controllers/
       │   └── providers/
       ├── analysis/
       │   ├── models/
       │   ├── views/
       │   ├── controllers/
       │   └── providers/
       └── core/
           ├── constants/
           ├── utils/
           └── widgets/
       ```
   - 動作確認:
     - [ ] ディレクトリ構造が正しく作成されていること

### フェーズ 2: 音声アップロード機能実装

6. **アップロードモデルの実装**

   - 概要: 音声ファイルアップロードに関するモデルの実装
   - 完了条件:
     - [ ] `AudioFileModel`クラスの実装
     - [ ] GCS 署名付き URL 生成ロジックの実装
   - 動作確認:
     - [ ] ユニットテストの作成と実行
     - [ ] GCS へのアップロードテスト

7. **アップロード UI の実装**

   - 概要: 音声ファイルアップロード画面の実装
   - 完了条件:
     - [ ] `UploadPage` (HookConsumerWidget)の実装
     - [ ] ドラッグ&ドロップ対応
     - [ ] ファイル選択ダイアログ対応
     - [ ] アップロード進捗表示
   - 動作確認:
     - [ ] ファイル選択の動作確認
     - [ ] プログレスバーの表示確認
     - [ ] エラー表示の確認

8. **アップロード状態管理の実装**
   - 概要: アップロード状態の HooksRiverpod 実装
   - 完了条件:
     - [ ] `UploadController`の実装
     - [ ] `UploadStateNotifier`の実装
     - [ ] カスタム Hook `useFileUpload`の実装
   - 動作確認:
     - [ ] アップロード状態の変更テスト
     - [ ] エラーハンドリングのテスト

### フェーズ 3: 分析結果表示機能実装

9. **分析モデルの実装**

   - 概要: 分析結果に関するモデルクラスの実装
   - 完了条件:
     - [ ] `TranscriptModel`の実装
     - [ ] `FeedbackModel`の実装
     - [ ] `AnalysisModel`の実装
   - 動作確認:
     - [ ] ユニットテストの作成と実行
     - [ ] JSON パース処理の確認

10. **音声プレイヤーの実装**

    - 概要: 音声再生機能の実装
    - 完了条件:
      - [ ] `AudioPlayerWidget` (HookConsumerWidget)の実装
      - [ ] 再生/一時停止/シーク機能
    - 動作確認:
      - [ ] 音声再生の動作確認
      - [ ] シーク機能の動作確認

11. **文字起こし表示の実装**

    - 概要: 文字起こし結果表示機能の実装
    - 完了条件:
      - [ ] `TranscriptWidget` (HookConsumerWidget)の実装
      - [ ] 話者別の表示スタイル
      - [ ] タイムスタンプ表示
    - 動作確認:
      - [ ] 表示レイアウトの確認
      - [ ] スクロール動作の確認

12. **グラフ表示の実装**

    - 概要: 非言語情報のグラフ表示機能の実装
    - 完了条件:
      - [ ] `GraphWidget` (HookConsumerWidget)の実装
      - [ ] 時系列データの描画
    - 動作確認:
      - [ ] グラフ描画の確認
      - [ ] インタラクションの確認

13. **フィードバック表示の実装**

    - 概要: AI フィードバック表示機能の実装
    - 完了条件:
      - [ ] `FeedbackWidget` (HookConsumerWidget)の実装
      - [ ] Markdown パース処理
    - 動作確認:
      - [ ] カード表示の確認
      - [ ] Markdown 描画の確認

14. **分析結果状態管理の実装**
    - 概要: 分析結果の状態管理実装
    - 完了条件:
      - [ ] `AnalysisController`の実装
      - [ ] 各種 StateNotifier の実装
    - 動作確認:
      - [ ] 状態更新の伝播確認
      - [ ] エラーハンドリングの確認

### フェーズ 4: 認証機能実装

3. **認証モデルの実装**

   - 概要: ユーザー認証に関するモデルクラスの実装
   - 完了条件:
     - [ ] `UserModel`クラスの実装
     - [ ] Firebase Authentication との連携
   - 動作確認:
     - [ ] ユニットテストの作成と実行
     - [ ] `flutter test`が通ること

4. **認証 UI の実装**

   - 概要: ログイン画面の実装
   - 完了条件:
     - [ ] `LoginPage` (HookConsumerWidget)の実装
     - [ ] メールアドレス/パスワードフォームの実装
     - [ ] エラーハンドリングとバリデーション
   - 動作確認:
     - [ ] 画面表示の確認
     - [ ] バリデーションの動作確認
     - [ ] エラー表示の確認

5. **認証状態管理の実装**
   - 概要: HooksRiverpod を使用した認証状態管理の実装
   - 完了条件:
     - [ ] `AuthController`の実装
     - [ ] `AuthStateNotifier`の実装
     - [ ] 認証状態の永続化
   - 動作確認:
     - [ ] ログイン/ログアウトの状態遷移テスト
     - [ ] 永続化されたセッションの確認

## ❓ 未解決の課題・確認事項

1. **グラフ表示について**

   - 非言語情報の折れ線グラフの縦軸の具体的な指標定義
   - グラフライブラリの選定（fl_chart vs custom 実装）

2. **音声プレイヤーについて**

   - 使用するパッケージの選定（just_audio vs audioplayers）
   - シーク時の精度要件

3. **エラーハンドリング**
   - リトライポリシーの定義
   - エラーメッセージの文言定義

## 🔗 関連ドキュメント

- 実装要件: [specification.md](./specification.md)
- 設計方針: [design-doc.md](./design-doc.md)

## 優先度：HIGH（最初に着手）

### 1. 開発環境構築

- [ ] プロジェクトのセットアップ

  - [ ] Flutter/Dart 環境構築
  - [ ] 依存パッケージの追加
  - [ ] .env.development の作成

- [ ] GitHub 設定

  - [ ] ブランチ保護ルール設定
    - main/develop ブランチの保護
    - PR レビュー必須化
    - CI チェック必須化
  - [ ] PR テンプレート作成

- [ ] CI/CD 設定
  - [ ] GitHub Actions 設定
    - [ ] Lint チェック
    - [ ] テスト実行
    - [ ] カバレッジレポート生成
    - [ ] ビルド確認
  - [ ] デプロイワークフロー設定

### 2. 基本機能実装

#### 音声アップロード機能

- [ ] `UploadPage` 実装
- [ ] アップロード状態管理
- [ ] GCS 連携

#### 認証機能

- [ ] `LoginPage` 実装
- [ ] Firebase Auth 連携
- [ ] ルーティング設定

#### 分析結果表示機能

- [ ] `AnalysisPage` 実装
- [ ] Firestore 監視実装
- [ ] UI 表示（プレイヤー、グラフ等）

## 優先度：MEDIUM（基本機能後に着手）

### エラーハンドリング

- [ ] エラーメッセージの日本語化
- [ ] エラー表示コンポーネント実装
- [ ] リトライ処理実装

### 状態管理

- [ ] 各種 StateNotifier 実装
- [ ] カスタム Hooks 実装

## 優先度：LOW（余裕があれば対応）

### テスト実装

- [ ] 基本的なユニットテスト
- [ ] 主要なウィジェットテスト

### ドキュメント

- [ ] README.md 作成
- [ ] 環境構築手順書作成

## 後日設定項目

1. テストカバレッジの基準値
2. レビュールール詳細
3. 追加の環境変数
4. 追加のエラーパターン
