<!-- Generated by SpecStory -->

# Update documentation comments for usecases (2025-06-24 00:00:08)

_**User**_

lib/upload/usecases配下の各ファイルを
cursor/rules/coding-standards.mdcに準拠したドキュメンテーションコメントを記載した形に修正してください。

---

_**Assistant**_

✅ provider.mdc  
✅ User Rules  
Accuracy Estimate: 98 %  
Model: GPT-4.1  

ご要望の lib/upload/usecases 配下の各ファイルに対し、cursor/rules/coding-standards.mdc（= 本プロジェクトのルール）に準拠したドキュメンテーションコメント（日本語、一文要約＋詳細、クラスは名詞句、関数は動詞、識別子は角括弧、等）を追加します。  
既存のパブリックなクラス・関数・メソッド・プロパティすべてが対象です。  
コメントの追加後、ルール遵守を再確認し、必要に応じて修正も行います。  

これより各ファイルを順次確認し、編集を進めます。

---

Read file: lib/upload/usecases/validate_audio_file_usecase.dart

---

Read file: lib/upload/usecases/upload_to_storage_usecase.dart

---

Read file: lib/upload/usecases/request_analysis_usecase.dart

---

Read file: lib/upload/usecases/extract_audio_segment_usecase.dart

---

Read file: lib/upload/usecases/request_analysis_exception.dart

---

Read file: lib/upload/usecases/extract_audio_segment_exception.dart

---

Read file: lib/upload/usecases/upload_to_storage_exception.dart

---

Read file: lib/upload/usecases/validate_audio_file_exception.dart

---

```diff
  import 'validate_audio_file_exception.dart';
  
- /// [ValidateAudioFileUseCase] の Provider。
+ /// 音声ファイルの検証と長さ取得を行う UseCase の Provider。
+ ///
+ /// [ValidateAudioFileUseCase] のインスタンスを提供する。
  final validateAudioFileUseCaseProvider = Provider(
    (ref) => ValidateAudioFileUseCase(),
  );
  
- /// 音声ファイルの検証と長さ取得を行う UseCase。
+ /// 音声ファイルの検証と長さ取得を行うクラス。
+ ///
+ /// ファイル形式や長さの検証を行い、音声長（秒）を取得する。
  class ValidateAudioFileUseCase {
    /// ロガーインスタンス。
    final Roggle logger;
  
-   /// コンストラクタ。
+   /// [ValidateAudioFileUseCase] のインスタンスを生成する。
+   ///
+   /// [logger] を省略した場合はデフォルトの [Roggle] を利用する。
    ValidateAudioFileUseCase({Roggle? logger}) : logger = logger ?? Roggle();
  
    /// ファイル形式・長さの検証を行い、音声長（秒）を返す。
    ///
    /// 検証に失敗した場合は [ValidateAudioFileException] を投げる。
+   ///
+   /// [file] 検証対象の音声ファイル。
+   ///
+   /// 戻り値は音声ファイルの長さ（秒）。
    Future<double> call(html.File file) async {
      final fileName = file.name.toLowerCase();
```

---

```diff
  import 'upload_to_storage_exception.dart';
  
- /// [UploadToStorageUseCase] の Provider。
+ /// Firebase Storage へのファイルアップロードを行う UseCase の Provider。
+ ///
+ /// [UploadToStorageUseCase] のインスタンスを提供する。
  final uploadToStorageUseCaseProvider = Provider(
    (ref) => UploadToStorageUseCase(),
  );
  
- /// Firebase Storage へファイルをアップロードする UseCase。
+ /// Firebase Storage へファイルをアップロードするクラス。
+ ///
+ /// ファイルをアップロードし、ダウンロード URL を取得する。
  class UploadToStorageUseCase {
    /// ロガーインスタンス。
    final Roggle logger;
  
-   /// コンストラクタ。
+   /// [UploadToStorageUseCase] のインスタンスを生成する。
+   ///
+   /// [logger] を省略した場合はデフォルトの [Roggle] を利用する。
    UploadToStorageUseCase({Roggle? logger}) : logger = logger ?? Roggle();
  
    /// ファイルを Firebase Storage にアップロードし、ダウンロード URL を返す。
    ///
    /// アップロードに失敗した場合は [UploadToStorageException] を投げる。
+   ///
+   /// [file] アップロード対象のファイル。
+   /// [originalFileName] 元のファイル名（省略可）。
+   /// [onProgress] 進捗コールバック（省略可）。
+   ///
+   /// 戻り値はアップロード後のダウンロード URL。
    Future<String> call(
      html.Blob file, {
```

---

```diff
  import 'request_analysis_exception.dart';
  
- /// [RequestAnalysisUseCase] の Provider。
+ /// 音声分析 API を呼び出す UseCase の Provider。
+ ///
+ /// [RequestAnalysisUseCase] のインスタンスを提供する。
  final requestAnalysisUseCaseProvider = Provider((ref) {
    final analysisService = ref.read(analysisServiceProvider);
    return RequestAnalysisUseCase(analysisService);
  });
  
- /// 音声分析 API を呼び出す UseCase。
+ /// 音声分析 API を呼び出すクラス。
+ ///
+ /// 指定したファイル URI とユーザー ID で音声分析 API を呼び出す。
  class RequestAnalysisUseCase {
-   /// [AnalysisService]。
+   /// [AnalysisService] のインスタンス。
    final AnalysisService _analysisService;
  
```

```diff
  
    /// [RequestAnalysisUseCase] のインスタンスを生成する。
+   ///
+   /// [analysisService] 音声分析サービス。
+   /// [logger] を省略した場合はデフォルトの [Roggle] を利用する。
    RequestAnalysisUseCase(this._analysisService, {Roggle? logger})
      : logger = logger ?? Roggle();
```

```diff
    ///
    /// 失敗した場合は [RequestAnalysisException] を投げる。
+   ///
+   /// [fileUri] 分析対象ファイルの URI。
+   /// [userId] ユーザー ID。
    Future<void> call({required String fileUri, required String userId}) async {
      try {
```

---

```diff
  import 'extract_audio_segment_exception.dart';
  
- /// [ExtractAudioSegmentUseCase] の Provider。
+ /// 音声ファイルから 15 分以内のセグメントを抽出する UseCase の Provider。
+ ///
+ /// [ExtractAudioSegmentUseCase] のインスタンスを提供する。
  final extractAudioSegmentUseCaseProvider = Provider(
    (ref) => ExtractAudioSegmentUseCase(),
  );
  
- /// 音声ファイルから 15 分以内のセグメントを抽出する UseCase。
+ /// 音声ファイルから 15 分以内のセグメントを抽出するクラス。
+ ///
+ /// 15 分を超える場合は冒頭 15 分分のバイト数でスライスしたファイルを返す。
  class ExtractAudioSegmentUseCase {
+   /// ロガーインスタンス。
    final Roggle logger;
  
+   /// [ExtractAudioSegmentUseCase] のインスタンスを生成する。
+   ///
+   /// [logger] を省略した場合はデフォルトの [Roggle] を利用する。
    ExtractAudioSegmentUseCase({Roggle? logger}) : logger = logger ?? Roggle();
  
```

```diff
    ///
    /// 抽出に失敗した場合は [ExtractAudioSegmentException] を投げる。
+   ///
+   /// [file] 対象の音声ファイル。
+   /// [duration] 音声ファイルの長さ（秒）。
+   ///
+   /// 戻り値は抽出後の [html.Blob]。
    Future<html.Blob> call(html.File file, double duration) async {
      const maxDurationSec = 15 * 60;
```

---

```diff
- /// 音声分析 API 呼び出しの例外。
+ /// 音声分析 API 呼び出し時の例外。
+ ///
+ /// 音声分析 API の呼び出しに失敗した場合にスローされる。
  class RequestAnalysisException implements Exception {
    /// エラーメッセージ。
    final String message;
  
    /// [RequestAnalysisException] のインスタンスを生成する。
+   ///
+   /// [message] エラーメッセージ。
    RequestAnalysisException(this.message);
    @override
```

---

```diff
- /// 音声セグメント抽出の例外。
+ /// 音声セグメント抽出時の例外。
+ ///
+ /// 音声ファイルからセグメント抽出に失敗した場合にスローされる。
  class ExtractAudioSegmentException implements Exception {
    /// エラーメッセージ。
    final String message;
  
    /// [ExtractAudioSegmentException] のインスタンスを生成する。
+   ///
+   /// [message] エラーメッセージ。
    ExtractAudioSegmentException(this.message);
    @override
```

---

```diff
- /// Firebase Storage アップロードの例外。
+ /// Firebase Storage アップロード時の例外。
+ ///
+ /// Firebase Storage へのファイルアップロードに失敗した場合にスローされる。
  class UploadToStorageException implements Exception {
    /// エラーメッセージ。
    final String message;
  
    /// [UploadToStorageException] のインスタンスを生成する。
+   ///
+   /// [message] エラーメッセージ。
    UploadToStorageException(this.message);
    @override
```

---

```diff
- /// 音声ファイル検証の例外。
+ /// 音声ファイル検証時の例外。
+ ///
+ /// 音声ファイルの検証に失敗した場合にスローされる。
  class ValidateAudioFileException implements Exception {
    /// エラーメッセージ。
    final String message;
  
    /// [ValidateAudioFileException] のインスタンスを生成する。
+   ///
+   /// [message] エラーメッセージ。
    ValidateAudioFileException(this.message);
    @override
```

---

✅ provider.mdc  
✅ User Rules  
Accuracy Estimate: 98 %  
Model: GPT-4.1  

lib/upload/usecases 配下の全ファイルに対し、  
- すべてのパブリックなクラス・関数・メソッド・プロパティに  
  - 一文要約＋空行＋詳細説明  
  - 識別子は角括弧  
  - クラスは名詞句、関数は動詞  
  - パラメータや戻り値の説明  
  - 日本語の文法ルール  
を遵守したドキュメンテーションコメントを追加・修正しました。

**主な修正内容：**
- Provider 定義部に「インスタンスを提供する」旨の説明を追加
- クラス説明に「何をするクラスか」の一文要約＋詳細
- コンストラクタ・メソッド・プロパティにパラメータや戻り値の説明
- 例外クラスも「何の例外か」「どんな時にスローされるか」を明記

ルール（cursor/rules/coding-standards.mdc）に完全準拠していることを確認済みです。  
もし追加でご要望があればご指示ください。

💡 provider.mdc

---

