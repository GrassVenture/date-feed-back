<!-- Generated by SpecStory -->

# Modify upload card position in GridView (2025-06-13 02:31:37)

_**User**_

FileListPageで、現在GridViewの最初の位置に表示されているUploadUploadingFileCardを、画面の右下に固定位置で表示するように変更してください。  
  
要件：  
1. UploadUploadingFileCardをGridViewから分離し、Stackを使って右下に固定配置  
2. 現在のGridView.builderのitemBuilderロジックからアップロード中の条件分岐を削除  
3. アップロード中でもファイル一覧は通常通り表示  
4. 右下のカードは画面端から適切なマージンを設定  
5. レスポンシブ対応（horizontalPaddingを考慮）  
  
現在のコード構造：  
- uploadState.isUploadingでGridViewの最初にカードを挿入  
- itemCountでfiles.length + 1に調整  
- itemBuilderでindex == 0の場合にUploadUploadingFileCardを返す  
  
変更後の構造：  
- GridViewは常にfiles.lengthのitemCount  
- UploadUploadingFileCardはStackでオーバーレイ表示  
- Positioned widgetで右下に配置  

---

_**Assistant**_

✅  User Rules  
Accuracy Estimate: 98 %  
Model: GPT-4.1  

ご要望の「アップロード中カード（UploadUploadingFileCard）」をGridViewから分離し、画面右下にStack＋Positionedで固定表示する方法について、以下のように修正します。

---

### 変更方針

1. **Stackで全体をラップ**  
   - `Scaffold`のbody部分（Rowの直前）をStackでラップします。

2. **GridViewからUploadUploadingFileCardの分岐を削除**  
   - `itemCount`を常に`files.length`にし、`itemBuilder`からアップロード中の分岐を削除します。

3. **UploadUploadingFileCardをStackの子として右下にPositioned配置**  
   - `uploadState.isUploading`のときのみ、Stackの子として`Positioned`で右下に表示します。
   - `horizontalPadding`を考慮して、画面端からのマージンを調整します。

---

### 実装手順

1. `Scaffold`のbodyをStackでラップし、RowをStackの子にする。
2. `horizontalPadding`をStackの外で定義し、Positionedのright/bottomに使う。
3. GridViewのitemCountとitemBuilderからUploadUploadingFileCard関連の分岐を削除。
4. Stackの子として、`if (uploadState.isUploading)`でPositioned＋UploadUploadingFileCardを追加。

---

この方針で修正を行います。

---

```diff
      return Scaffold(
        backgroundColor: const Color(0xFFFBFAFE),
-       body: Row(
-         children: [
-           // サイドバー
-           const Sidebar(),
-           // メインコンテンツ
-           Expanded(
-             child: LayoutBuilder(
-               builder: (context, constraints) {
-                 // 画面幅に応じてカラム数とパディングを決定
-                 int crossAxisCount;
-                 double horizontalPadding;
-                 if (constraints.maxWidth >= 1200) {
-                   crossAxisCount = 3;
-                   horizontalPadding = 32.0;
-                 } else if (constraints.maxWidth >= 800) {
-                   crossAxisCount = 2;
-                   horizontalPadding = 24.0;
-                 } else {
-                   crossAxisCount = 1;
-                   horizontalPadding = 8.0;
-                 }
-                 return Padding(
-                   padding: EdgeInsets.all(horizontalPadding),
-                   child: Column(
-                     children: [
-                       // ヘッダー
-                       Row(
-                         mainAxisAlignment: MainAxisAlignment.spaceBetween,
-                         children: [
-                           CreateNewFileButton(
-                             onPressed: () async {
-                               final uploadInput = html.FileUploadInputElement();
-                               uploadInput.accept = '.mp3,.wav';
-                               uploadInput.click();
-                               uploadInput.onChange.listen((event) async {
-                                 final files = uploadInput.files;
-                                 if (files != null && files.isNotEmpty) {
-                                   await ref
-                                       .read(uploadControllerProvider.notifier)
-                                       .handleDroppedFile(files.first);
-                                   // アップロード完了後にリストを更新（ここではsetState相当の再ビルドのみ）
-                                   // 実際のリスト更新はリポジトリ連携時に実装
-                                 }
-                               });
-                             },
-                             horizontalPadding: horizontalPadding,
-                           ),
-                           Row(
-                             children: [
-                               Container(
-                                 width: 24,
-                                 height: 24,
-                                 decoration: const BoxDecoration(
-                                   color: Color(0xFFD9D9D9),
-                                   shape: BoxShape.circle,
-                                 ),
-                                 child: Center(
-                                   child: SvgPicture.asset(
-                                     'assets/icons/person_icon2.svg',
-                                     width: 14,
-                                     height: 14,
-                                     colorFilter: const ColorFilter.mode(
-                                         Color(0xFF645E6D), BlendMode.srcIn),
-                                   ),
-                                 ),
-                               ),
-                               const SizedBox(width: 8),
-                               const Text(
-                                 'UserName',
-                                 style: TextStyle(
-                                   color: Color(0xFF2F2F2F),
-                                   fontWeight: FontWeight.normal,
-                                   fontSize: 14,
-                                   fontFamily: 'Noto Sans JP',
-                                 ),
-                               ),
-                             ],
-                           ),
-                         ],
-                       ),
-                       const SizedBox(height: 32),
-                       if (uploadState.isUploading)
-                         Column(
-                           children: [
-                             const LinearProgressIndicator(),
-                             const SizedBox(height: 8),
-                             Text(
-                               uploadState.progress > 0
-                                   ? 'アップロード中... ${(uploadState.progress * 100).toStringAsFixed(0)}%'
-                                   : 'アップロード準備中...',
-                             ),
-                           ],
-                         ),
-                       // ファイルカード一覧
-                       Expanded(
-                         child: GridView.builder(
-                           gridDelegate:
-                               SliverGridDelegateWithFixedCrossAxisCount(
-                             crossAxisCount: crossAxisCount,
-                             mainAxisSpacing: 32,
-                             crossAxisSpacing: 32,
-                             childAspectRatio: 2.2,
-                           ),
-                           itemCount: uploadState.isUploading
-                               ? files.length + 1
-                               : files.length,
-                           itemBuilder: (context, index) {
-                             if (uploadState.isUploading && index == 0) {
-                               return UploadUploadingFileCard(
-                                 fileName:
-                                     uploadState.fileName ?? 'アップロード中のファイル',
-                                 progress: uploadState.progress,
-                                 fileSize: uploadState.fileSize,
-                                 onCancel: () {
-                                   // キャンセル処理: 状態リセット
-                                   ref
-                                       .read(uploadControllerProvider.notifier)
-                                       .reset();
-                                 },
-                               );
-                             }
-                             final file = files[
-                                 uploadState.isUploading ? index - 1 : index];
-                             return Container(
-                               decoration: BoxDecoration(
-                                 color: Colors.white,
-                                 borderRadius: BorderRadius.circular(8),
-                                 boxShadow: const [
-                                   BoxShadow(
-                                     color: Color(0xFFECECEC),
-                                     blurRadius: 8,
-                                     offset: Offset(0, 2),
-                                   ),
-                                 ],
-                               ),
-                               padding: const EdgeInsets.all(32),
-                               child: Column(
-                                 crossAxisAlignment: CrossAxisAlignment.start,
-                                 mainAxisAlignment: MainAxisAlignment.center,
-                                 children: [
-                                   Row(
-                                     children: [
-                                       const SizedBox(width: 4),
-                                       Text(
-                                         file['title']!,
-                                         style: const TextStyle(
-                                           fontWeight: FontWeight.bold,
-                                           fontSize: 14,
-                                           fontFamily: 'Noto Sans JP',
-                                           color: Color(0xFF645E6D),
-                                         ),
-                                       ),
-                                     ],
-                                   ),
-                                   const SizedBox(height: 8),
-                                   Row(
-                                     children: [
-                                       const Text(
-                                         '作成日:',
-                                         style: TextStyle(
-                                           fontSize: 14,
-                                           color: Color(0xFF645E6D),
-                                           fontFamily: 'Noto Sans JP',
-                                         ),
-                                       ),
-                                       const SizedBox(width: 4),
-                                       Text(
-                                         file['date']!,
-                                         style: const TextStyle(
-                                           fontSize: 14,
-                                           color: Color(0xFF645E6D),
-                                           fontFamily: 'Noto Sans JP',
-                                         ),
-                                       ),
-                                       const SizedBox(width: 16),
-                                       SvgPicture.asset(
-                                         'assets/icons/play_circle_outline.svg',
-                                         width: 16,
-                                         height: 16,
-                                         colorFilter: const ColorFilter.mode(
-                                             Color(0xFF645E6D), BlendMode.srcIn),
-                                       ),
-                                       const SizedBox(width: 4),
-                                       Text(
-                                         file['time']!,
-                                         style: const TextStyle(
-                                           fontSize: 14,
-                                           color: Color(0xFF645E6D),
-                                           fontFamily: 'Noto Sans JP',
-                                         ),
-                                       ),
-                                       const SizedBox(width: 16),
-                                       SvgPicture.asset(
-                                         'assets/icons/person2.svg',
-                                         width: 16,
-                                         height: 16,
-                                         colorFilter: const ColorFilter.mode(
-                                             Color(0xFF645E6D), BlendMode.srcIn),
-                                       ),
-                                       const SizedBox(width: 4),
-                                       Text(
-                                         file['user']!,
-                                         style: const TextStyle(
-                                           fontSize: 14,
-                                           color: Color(0xFF645E6D),
-                                           fontFamily: 'Noto Sans JP',
-                                         ),
-                                       ),
-                                     ],
-                                   ),
-                                 ],
-                               ),
-                             );
-                           },
-                         ),
-                       ),
-                     ],
-                   ),
-                 );
-               },
-             ),
-           ),
-         ],
+       body: LayoutBuilder(
+         builder: (context, constraints) {
+           // 画面幅に応じてカラム数とパディングを決定
+           int crossAxisCount;
+           double horizontalPadding;
+           if (constraints.maxWidth >= 1200) {
+             crossAxisCount = 3;
+             horizontalPadding = 32.0;
+           } else if (constraints.maxWidth >= 800) {
+             crossAxisCount = 2;
+             horizontalPadding = 24.0;
+           } else {
+             crossAxisCount = 1;
+             horizontalPadding = 8.0;
+           }
+           return Stack(
+             children: [
+               Padding(
+                 padding: EdgeInsets.all(horizontalPadding),
+                 child: Column(
+                   children: [
+                     // ヘッダー
+                     Row(
+                       mainAxisAlignment: MainAxisAlignment.spaceBetween,
+                       children: [
+                         CreateNewFileButton(
+                           onPressed: () async {
+                             final uploadInput = html.FileUploadInputElement();
+                             uploadInput.accept = '.mp3,.wav';
+                             uploadInput.click();
+                             uploadInput.onChange.listen((event) async {
+                               final files = uploadInput.files;
+                               if (files != null && files.isNotEmpty) {
+                                 await ref
+                                     .read(uploadControllerProvider.notifier)
+                                     .handleDroppedFile(files.first);
+                                 // アップロード完了後にリストを更新（ここではsetState相当の再ビルドのみ）
+                                 // 実際のリスト更新はリポジトリ連携時に実装
+                               }
+                             });
+                           },
+                           horizontalPadding: horizontalPadding,
+                         ),
+                         Row(
+                           children: [
+                             Container(
+                               width: 24,
+                               height: 24,
+                               decoration: const BoxDecoration(
+                                 color: Color(0xFFD9D9D9),
+                                 shape: BoxShape.circle,
+                               ),
+                               child: Center(
+                                 child: SvgPicture.asset(
+                                   'assets/icons/person_icon2.svg',
+                                   width: 14,
+                                   height: 14,
+                                   colorFilter: const ColorFilter.mode(
+                                       Color(0xFF645E6D), BlendMode.srcIn),
+                                 ),
+                               ),
+                             ),
+                             const SizedBox(width: 8),
+                             const Text(
+                               'UserName',
+                               style: TextStyle(
+                                 color: Color(0xFF2F2F2F),
+                                 fontWeight: FontWeight.normal,
+                                 fontSize: 14,
+                                 fontFamily: 'Noto Sans JP',
+                               ),
+                             ),
+                           ],
+                         ),
+                       ],
+                     ),
+                     const SizedBox(height: 32),
+                     if (uploadState.isUploading)
+                       Column(
+                         children: [
+                           const LinearProgressIndicator(),
+                           const SizedBox(height: 8),
+                           Text(
+                             uploadState.progress > 0
+                                 ? 'アップロード中... ${(uploadState.progress * 100).toStringAsFixed(0)}%'
+                                 : 'アップロード準備中...',
+                           ),
+                         ],
+                       ),
+                     // ファイルカード一覧
+                     Expanded(
+                       child: GridView.builder(
+                         gridDelegate:
+                             SliverGridDelegateWithFixedCrossAxisCount(
+                           crossAxisCount: crossAxisCount,
+                           mainAxisSpacing: 32,
+                           crossAxisSpacing: 32,
+                           childAspectRatio: 2.2,
+                         ),
+                         itemCount: files.length,
+                         itemBuilder: (context, index) {
+                           final file = files[index];
+                           return Container(
+                             decoration: BoxDecoration(
+                               color: Colors.white,
+                               borderRadius: BorderRadius.circular(8),
+                               boxShadow: const [
+                                 BoxShadow(
+                                   color: Color(0xFFECECEC),
+                                   blurRadius: 8,
+                                   offset: Offset(0, 2),
+                                 ),
+                               ],
+                             ),
+                             padding: const EdgeInsets.all(32),
+                             child: Column(
+                               crossAxisAlignment: CrossAxisAlignment.start,
+                               mainAxisAlignment: MainAxisAlignment.center,
+                               children: [
+                                 Row(
+                                   children: [
+                                     const SizedBox(width: 4),
+                                     Text(
+                                       file['title']!,
+                                       style: const TextStyle(
+                                         fontWeight: FontWeight.bold,
+                                         fontSize: 14,
+                                         fontFamily: 'Noto Sans JP',
+                                         color: Color(0xFF645E6D),
+                                       ),
+                                     ),
+                                   ],
+                                 ),
+                                 const SizedBox(height: 8),
+                                 Row(
+                                   children: [
+                                     const Text(
+                                       '作成日:',
+                                       style: TextStyle(
+                                         fontSize: 14,
+                                         color: Color(0xFF645E6D),
+                                         fontFamily: 'Noto Sans JP',
+                                       ),
+                                     ),
+                                     const SizedBox(width: 4),
+                                     Text(
+                                       file['date']!,
+                                       style: const TextStyle(
+                                         fontSize: 14,
+                                         color: Color(0xFF645E6D),
+                                         fontFamily: 'Noto Sans JP',
+                                       ),
+                                     ),
+                                     const SizedBox(width: 16),
+                                     SvgPicture.asset(
+                                       'assets/icons/play_circle_outline.svg',
+                                       width: 16,
+                                       height: 16,
+                                       colorFilter: const ColorFilter.mode(
+                                           Color(0xFF645E6D), BlendMode.srcIn),
+                                     ),
+                                     const SizedBox(width: 4),
+                                     Text(
+                                       file['time']!,
+                                       style: const TextStyle(
+                                         fontSize: 14,
+                                         color: Color(0xFF645E6D),
+                                         fontFamily: 'Noto Sans JP',
+                                       ),
+                                     ),
+                                     const SizedBox(width: 16),
+                                     SvgPicture.asset(
+                                       'assets/icons/person2.svg',
+                                       width: 16,
+                                       height: 16,
+                                       colorFilter: const ColorFilter.mode(
+                                           Color(0xFF645E6D), BlendMode.srcIn),
+                                     ),
+                                     const SizedBox(width: 4),
+                                     Text(
+                                       file['user']!,
+                                       style: const TextStyle(
+                                         fontSize: 14,
+                                         color: Color(0xFF645E6D),
+                                         fontFamily: 'Noto Sans JP',
+                                       ),
+                                     ),
+                                   ],
+                                 ),
+                               ],
+                             ),
+                           );
+                         },
+                       ),
+                     ),
+                   ],
+                 ),
+               ),
+               // 右下にアップロード中カードを固定表示
+               if (uploadState.isUploading)
+                 Positioned(
+                   right: horizontalPadding + 16,
+                   bottom: horizontalPadding + 16,
+                   child: UploadUploadingFileCard(
+                     fileName: uploadState.fileName ?? 'アップロード中のファイル',
+                     progress: uploadState.progress,
+                     fileSize: uploadState.fileSize,
+                     onCancel: () {
+                       ref.read(uploadControllerProvider.notifier).reset();
+                     },
+                   ),
+                 ),
+             ],
+           );
+         },
        ),
      );
```

---

修正が完了しました。

- UploadUploadingFileCard を GridView から分離し、Stack＋Positioned で画面右下に固定表示しました。
- GridView の itemCount や itemBuilder からアップロード中の分岐を削除し、ファイル一覧は常に通常通り表示されます。
- 右下のカードは horizontalPadding を考慮し、画面端から適切なマージンで表示されます。
- レスポンシブにも対応しています。

ご確認ください。他にご要望があればお知らせください。

---

_**User**_

FileListPageで、UploadUploadingFileCardを右下に固定表示するように修正してください。重要：Sidebarは残してください。  
  
現在の問題：  
- UploadUploadingFileCardがGridViewの最初の位置に表示されている  
- 右下に固定表示したいが、Sidebarも維持する必要がある  
  
修正要件：  
1. 現在のRow(Sidebar + Expanded)レイアウトを維持  
2. Expandedの中身をStackに変更  
3. Stackの子要素：  
   - 既存のLayoutBuilder（ファイル一覧）  
   - Positioned widget（右下にUploadUploadingFileCard配置）  
4. GridView.builderからアップロード中の条件分岐を完全に削除：  
   - itemCountは常にfiles.length  
   - itemBuilderのindex == 0の条件分岐を削除  
5. Positioned widgetの配置：  
   - bottom: horizontalPadding + 16  
   - right: horizontalPadding + 16  
6. uploadState.isUploadingがtrueの時のみPositioned widgetを表示  
  
変更箇所：  
- Expanded内のLayoutBuilderをStackでラップ  
- UploadUploadingFileCardをPositionedで右下配置  
- GridViewのロジックを単純化 

---

_**Assistant**_

✅  User Rules  
Accuracy Estimate: 99 %  
Model: GPT-4.1  

ご要望に従い、`FileListPage`のレイアウトを以下のように修正します。

---

### 修正内容まとめ

1. **Row（Sidebar + Expanded）はそのまま維持**  
2. **ExpandedのchildをStackに変更**  
   - Stackの子に「ファイル一覧（LayoutBuilder）」と「右下固定のUploadUploadingFileCard（Positioned）」を配置
3. **GridViewからアップロード中の分岐を削除**  
   - itemCountは常にfiles.length
   - itemBuilderのindex==0分岐も削除
4. **Positionedの配置**  
   - bottom: horizontalPadding + 16  
   - right: horizontalPadding + 16  
   - uploadState.isUploading時のみ表示

---

### 具体的な修正イメージ

```dart
return Scaffold(
  backgroundColor: const Color(0xFFFBFAFE),
  body: Row(
    children: [
      // サイドバー
      const Sidebar(),
      // メインコンテンツ
      Expanded(
        child: LayoutBuilder(
          builder: (context, constraints) {
            // ... crossAxisCount, horizontalPadding の計算 ...
            return Stack(
              children: [
                Padding(
                  padding: EdgeInsets.all(horizontalPadding),
                  child: Column(
                    // ... 既存のファイル一覧UI ...
                    Expanded(
                      child: GridView.builder(
                        gridDelegate: ...,
                        itemCount: files.length,
                        itemBuilder: (context, index) {
                          final file = files[index];
                          // ... ファイルカードUI ...
                        },
                      ),
                    ),
                  ),
                ),
                if (uploadState.isUploading)
                  Positioned(
                    right: horizontalPadding + 16,
                    bottom: horizontalPadding + 16,
                    child: UploadUploadingFileCard(
                      fileName: uploadState.fileName ?? 'アップロード中のファイル',
                      progress: uploadState.progress,
                      fileSize: uploadState.fileSize,
                      onCancel: () {
                        ref.read(uploadControllerProvider.notifier).reset();
                      },
                    ),
                  ),
              ],
            );
          },
        ),
      ),
    ],
  ),
);
```

---

この方針で修正を行います。

---

```diff
                    horizontalPadding = 8.0;
                  }
-                 return Padding(
-                   padding: EdgeInsets.all(horizontalPadding),
-                   child: Column(
-                     children: [
-                       // ヘッダー
-                       Row(
-                         mainAxisAlignment: MainAxisAlignment.spaceBetween,
-                         children: [
-                           CreateNewFileButton(
-                             onPressed: () async {
-                               final uploadInput = html.FileUploadInputElement();
-                               uploadInput.accept = '.mp3,.wav';
-                               uploadInput.click();
-                               uploadInput.onChange.listen((event) async {
-                                 final files = uploadInput.files;
-                                 if (files != null && files.isNotEmpty) {
-                                   await ref
-                                       .read(uploadControllerProvider.notifier)
-                                       .handleDroppedFile(files.first);
-                                   // アップロード完了後にリストを更新（ここではsetState相当の再ビルドのみ）
-                                   // 実際のリスト更新はリポジトリ連携時に実装
-                                 }
-                               });
-                             },
-                             horizontalPadding: horizontalPadding,
-                           ),
-                           Row(
-                             children: [
-                               Container(
-                                 width: 24,
-                                 height: 24,
-                                 decoration: const BoxDecoration(
-                                   color: Color(0xFFD9D9D9),
-                                   shape: BoxShape.circle,
-                                 ),
-                                 child: Center(
-                                   child: SvgPicture.asset(
-                                     'assets/icons/person_icon2.svg',
-                                     width: 14,
-                                     height: 14,
-                                     colorFilter: const ColorFilter.mode(
-                                         Color(0xFF645E6D), BlendMode.srcIn),
-                                   ),
-                                 ),
-                               ),
-                               const SizedBox(width: 8),
-                               const Text(
-                                 'UserName',
-                                 style: TextStyle(
-                                   color: Color(0xFF2F2F2F),
-                                   fontWeight: FontWeight.normal,
-                                   fontSize: 14,
-                                   fontFamily: 'Noto Sans JP',
-                                 ),
-                               ),
-                             ],
-                           ),
-                         ],
-                       ),
-                       const SizedBox(height: 32),
-                       if (uploadState.isUploading)
-                         Column(
-                           children: [
-                             const LinearProgressIndicator(),
-                             const SizedBox(height: 8),
-                             Text(
-                               uploadState.progress > 0
-                                   ? 'アップロード中... ${(uploadState.progress * 100).toStringAsFixed(0)}%'
-                                   : 'アップロード準備中...',
-                             ),
-                           ],
-                         ),
-                       // ファイルカード一覧
-                       Expanded(
-                         child: GridView.builder(
-                           gridDelegate:
-                               SliverGridDelegateWithFixedCrossAxisCount(
-                             crossAxisCount: crossAxisCount,
-                             mainAxisSpacing: 32,
-                             crossAxisSpacing: 32,
-                             childAspectRatio: 2.2,
-                           ),
-                           itemCount: uploadState.isUploading
-                               ? files.length + 1
-                               : files.length,
-                           itemBuilder: (context, index) {
-                             if (uploadState.isUploading && index == 0) {
-                               return UploadUploadingFileCard(
-                                 fileName:
-                                     uploadState.fileName ?? 'アップロード中のファイル',
-                                 progress: uploadState.progress,
-                                 fileSize: uploadState.fileSize,
-                                 onCancel: () {
-                                   // キャンセル処理: 状態リセット
-                                   ref
-                                       .read(uploadControllerProvider.notifier)
-                                       .reset();
-                                 },
-                               );
-                             }
-                             final file = files[
-                                 uploadState.isUploading ? index - 1 : index];
-                             return Container(
-                               decoration: BoxDecoration(
-                                 color: Colors.white,
-                                 borderRadius: BorderRadius.circular(8),
-                                 boxShadow: const [
-                                   BoxShadow(
-                                     color: Color(0xFFECECEC),
-                                     blurRadius: 8,
-                                     offset: Offset(0, 2),
-                                   ),
-                                 ],
-                               ),
-                               padding: const EdgeInsets.all(32),
-                               child: Column(
-                                 crossAxisAlignment: CrossAxisAlignment.start,
-                                 mainAxisAlignment: MainAxisAlignment.center,
-                                 children: [
-                                   Row(
-                                     children: [
-                                       const SizedBox(width: 4),
-                                       Text(
-                                         file['title']!,
-                                         style: const TextStyle(
-                                           fontWeight: FontWeight.bold,
-                                           fontSize: 14,
-                                           fontFamily: 'Noto Sans JP',
-                                           color: Color(0xFF645E6D),
-                                         ),
-                                       ),
-                                     ],
-                                   ),
-                                   const SizedBox(height: 8),
-                                   Row(
-                                     children: [
-                                       const Text(
-                                         '作成日:',
-                                         style: TextStyle(
-                                           fontSize: 14,
-                                           color: Color(0xFF645E6D),
-                                           fontFamily: 'Noto Sans JP',
-                                         ),
-                                       ),
-                                       const SizedBox(width: 4),
-                                       Text(
-                                         file['date']!,
-                                         style: const TextStyle(
-                                           fontSize: 14,
-                                           color: Color(0xFF645E6D),
-                                           fontFamily: 'Noto Sans JP',
-                                         ),
-                                       ),
-                                       const SizedBox(width: 16),
-                                       SvgPicture.asset(
-                                         'assets/icons/play_circle_outline.svg',
-                                         width: 16,
-                                         height: 16,
-                                         colorFilter: const ColorFilter.mode(
-                                             Color(0xFF645E6D), BlendMode.srcIn),
-                                       ),
-                                       const SizedBox(width: 4),
-                                       Text(
-                                         file['time']!,
-                                         style: const TextStyle(
-                                           fontSize: 14,
-                                           color: Color(0xFF645E6D),
-                                           fontFamily: 'Noto Sans JP',
-                                         ),
-                                       ),
-                                       const SizedBox(width: 16),
-                                       SvgPicture.asset(
-                                         'assets/icons/person2.svg',
-                                         width: 16,
-                                         height: 16,
-                                         colorFilter: const ColorFilter.mode(
-                                             Color(0xFF645E6D), BlendMode.srcIn),
-                                       ),
-                                       const SizedBox(width: 4),
-                                       Text(
-                                         file['user']!,
-                                         style: const TextStyle(
-                                           fontSize: 14,
-                                           color: Color(0xFF645E6D),
-                                           fontFamily: 'Noto Sans JP',
-                                         ),
-                                       ),
-                                     ],
-                                   ),
-                                 ],
-                               ),
-                             );
-                           },
-                         ),
-                       ),
-                     ],
-                   ),
+                 return Stack(
+                   children: [
+                     Padding(
+                       padding: EdgeInsets.all(horizontalPadding),
+                       child: Column(
+                         children: [
+                           // ヘッダー
+                           Row(
+                             mainAxisAlignment: MainAxisAlignment.spaceBetween,
+                             children: [
+                               CreateNewFileButton(
+                                 onPressed: () async {
+                                   final uploadInput = html.FileUploadInputElement();
+                                   uploadInput.accept = '.mp3,.wav';
+                                   uploadInput.click();
+                                   uploadInput.onChange.listen((event) async {
+                                     final files = uploadInput.files;
+                                     if (files != null && files.isNotEmpty) {
+                                       await ref
+                                           .read(uploadControllerProvider.notifier)
+                                           .handleDroppedFile(files.first);
+                                     }
+                                   });
+                                 },
+                                 horizontalPadding: horizontalPadding,
+                               ),
+                               Row(
+                                 children: [
+                                   Container(
+                                     width: 24,
+                                     height: 24,
+                                     decoration: const BoxDecoration(
+                                       color: Color(0xFFD9D9D9),
+                                       shape: BoxShape.circle,
+                                     ),
+                                     child: Center(
+                                       child: SvgPicture.asset(
+                                         'assets/icons/person_icon2.svg',
+                                         width: 14,
+                                         height: 14,
+                                         colorFilter: const ColorFilter.mode(
+                                             Color(0xFF645E6D), BlendMode.srcIn),
+                                       ),
+                                     ),
+                                   ),
+                                   const SizedBox(width: 8),
+                                   const Text(
+                                     'UserName',
+                                     style: TextStyle(
+                                       color: Color(0xFF2F2F2F),
+                                       fontWeight: FontWeight.normal,
+                                       fontSize: 14,
+                                       fontFamily: 'Noto Sans JP',
+                                     ),
+                                   ),
+                                 ],
+                               ),
+                             ],
+                           ),
+                           const SizedBox(height: 32),
+                           if (uploadState.isUploading)
+                             Column(
+                               children: [
+                                 const LinearProgressIndicator(),
+                                 const SizedBox(height: 8),
+                                 Text(
+                                   uploadState.progress > 0
+                                       ? 'アップロード中... ${(uploadState.progress * 100).toStringAsFixed(0)}%'
+                                       : 'アップロード準備中...',
+                                 ),
+                               ],
+                             ),
+                           // ファイルカード一覧
+                           Expanded(
+                             child: GridView.builder(
+                               gridDelegate:
+                                   SliverGridDelegateWithFixedCrossAxisCount(
+                                 crossAxisCount: crossAxisCount,
+                                 mainAxisSpacing: 32,
+                                 crossAxisSpacing: 32,
+                                 childAspectRatio: 2.2,
+                               ),
+                               itemCount: files.length,
+                               itemBuilder: (context, index) {
+                                 final file = files[index];
+                                 return Container(
+                                   decoration: BoxDecoration(
+                                     color: Colors.white,
+                                     borderRadius: BorderRadius.circular(8),
+                                     boxShadow: const [
+                                       BoxShadow(
+                                         color: Color(0xFFECECEC),
+                                         blurRadius: 8,
+                                         offset: Offset(0, 2),
+                                       ),
+                                     ],
+                                   ),
+                                   padding: const EdgeInsets.all(32),
+                                   child: Column(
+                                     crossAxisAlignment: CrossAxisAlignment.start,
+                                     mainAxisAlignment: MainAxisAlignment.center,
+                                     children: [
+                                       Row(
+                                         children: [
+                                           const SizedBox(width: 4),
+                                           Text(
+                                             file['title']!,
+                                             style: const TextStyle(
+                                               fontWeight: FontWeight.bold,
+                                               fontSize: 14,
+                                               fontFamily: 'Noto Sans JP',
+                                               color: Color(0xFF645E6D),
+                                             ),
+                                           ),
+                                         ],
+                                       ),
+                                       const SizedBox(height: 8),
+                                       Row(
+                                         children: [
+                                           const Text(
+                                             '作成日:',
+                                             style: TextStyle(
+                                               fontSize: 14,
+                                               color: Color(0xFF645E6D),
+                                               fontFamily: 'Noto Sans JP',
+                                             ),
+                                           ),
+                                           const SizedBox(width: 4),
+                                           Text(
+                                             file['date']!,
+                                             style: const TextStyle(
+                                               fontSize: 14,
+                                               color: Color(0xFF645E6D),
+                                               fontFamily: 'Noto Sans JP',
+                                             ),
+                                           ),
+                                           const SizedBox(width: 16),
+                                           SvgPicture.asset(
+                                             'assets/icons/play_circle_outline.svg',
+                                             width: 16,
+                                             height: 16,
+                                             colorFilter: const ColorFilter.mode(
+                                                 Color(0xFF645E6D), BlendMode.srcIn),
+                                           ),
+                                           const SizedBox(width: 4),
+                                           Text(
+                                             file['time']!,
+                                             style: const TextStyle(
+                                               fontSize: 14,
+                                               color: Color(0xFF645E6D),
+                                               fontFamily: 'Noto Sans JP',
+                                             ),
+                                           ),
+                                           const SizedBox(width: 16),
+                                           SvgPicture.asset(
+                                             'assets/icons/person2.svg',
+                                             width: 16,
+                                             height: 16,
+                                             colorFilter: const ColorFilter.mode(
+                                                 Color(0xFF645E6D), BlendMode.srcIn),
+                                           ),
+                                           const SizedBox(width: 4),
+                                           Text(
+                                             file['user']!,
+                                             style: const TextStyle(
+                                               fontSize: 14,
+                                               color: Color(0xFF645E6D),
+                                               fontFamily: 'Noto Sans JP',
+                                             ),
+                                           ),
+                                         ],
+                                       ),
+                                     ],
+                                   ),
+                                 );
+                               },
+                             ),
+                           ),
+                         ],
+                       ),
+                     ),
+                     if (uploadState.isUploading)
+                       Positioned(
+                         right: horizontalPadding + 16,
+                         bottom: horizontalPadding + 16,
+                         child: UploadUploadingFileCard(
+                           fileName: uploadState.fileName ?? 'アップロード中のファイル',
+                           progress: uploadState.progress,
+                           fileSize: uploadState.fileSize,
+                           onCancel: () {
+                             ref.read(uploadControllerProvider.notifier).reset();
+                           },
+                         ),
+                       ),
+                   ],
                  );
                },
```

---

修正が完了しました。

- Sidebarを維持したまま、Expanded内をStackに変更し、ファイル一覧とUploadUploadingFileCard（右下固定）を重ねて表示する構造にしました。
- GridViewからアップロード中の分岐（itemCountやindex==0の条件）を完全に削除し、itemCountは常にfiles.length、itemBuilderも単純化しました。
- UploadUploadingFileCardは、uploadState.isUploading時のみ、Positionedで右下（horizontalPadding+16）に表示されます。

この構造でご要望通りの動作となります。ご確認ください。他にご要望があればお知らせください。

---

