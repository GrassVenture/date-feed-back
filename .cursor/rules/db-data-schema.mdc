---
description: 
globs: 
alwaysApply: false
---
# Firestore ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¨ Flutter ãƒ¢ãƒ‡ãƒ«è¨­è¨ˆãƒ«ãƒ¼ãƒ«

## ER å›³

```mermaid
erDiagram
    users ||--o{ dateSessions : has

    users {
        string name "Non-nullable | ãƒ¦ãƒ¼ã‚¶ãƒ¼å"
    }

    dateSessions {
        string storageUrl "Non-nullable | Firebase Storageã«ä¿å­˜ã•ã‚ŒãŸéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«URL"
        string status "Non-nullable | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆå€¤: 'pending', 'completed'ï¼‰"
        map conversationTranscript "Non-nullable | æ–‡å­—èµ·ã“ã—ãƒ‡ãƒ¼ã‚¿JSON"
        map conversationFeedback "Non-nullable | è§£æãƒ‡ãƒ¼ã‚¿JSON"
        map femaleEmotionGraph "Non-nullable | ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿JSON"
        timestamp createdAt "Non-nullable | ä½œæˆæ—¥æ™‚"
        timestamp updatedAt "Non-nullable | æ›´æ–°æ—¥æ™‚"
    }

```

# Flutter ãƒ¢ãƒ‡ãƒ«å‘½åãƒ»è¨­è¨ˆãƒ«ãƒ¼ãƒ«

Flutter ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹ Firebase Firestore ã®ãƒ¢ãƒ‡ãƒ«ã‚¯ãƒ©ã‚¹å®šç¾©ã«é–¢ã™ã‚‹ãƒ«ãƒ¼ãƒ«ã‚’ä»¥ä¸‹ã«ç¤ºã™ã€‚

## å‘½åè¦å‰‡

- å„ãƒ¢ãƒ‡ãƒ«ã‚¯ãƒ©ã‚¹åã¯ **Firestore ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³åã‚’è¸è¥²**ã—ã€**å˜æ•°å½¢ã® UpperCamelCase** ã§å®šç¾©ã™ã‚‹  
  ä¾‹: `dateSessions` â†’ `DateSession`

- ãŸã ã—ã€`users` ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«å¯¾å¿œã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã‚¯ãƒ©ã‚¹åã¯ `User` ã¨ã™ã‚‹ã¨ Firebase Authentication ã® `User` ã‚¯ãƒ©ã‚¹ã¨ç«¶åˆã™ã‚‹ãŸã‚ã€  
  **`AuthedUser`** ã¨å‘½åã™ã‚‹

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆIDã®æ‰±ã„

- Firestore ã®å„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ã«ã¯ã€**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè‡ªèº«ã® IDï¼ˆdocument IDï¼‰ã‚’ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦ã¯ä¿æŒã—ãªã„**
- ãŸã ã—ã€Flutter å´ã®ãƒ¢ãƒ‡ãƒ«ã‚¯ãƒ©ã‚¹ä¸Šã§ã¯ã€**document ID ã‚’ `id` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç­‰ã§ä¿æŒã™ã‚‹è¨­è¨ˆã¨ã™ã‚‹**

ä¾‹:
```dart
@freezed
class DateSession with _$DateSession {
  const factory DateSession({
    required String id, // Firestoreã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆIDï¼ˆã‚¢ãƒ—ãƒªå´ã§ä»˜ä¸ï¼‰
    required String storageUrl,
    required String status,
    Map<String, dynamic> conversationTranscript,
    Map<String, dynamic> conversationFeedback,
    Map<String, dynamic> femaleEmotionGraph,
    required DateTime createdAt,
    required DateTime updatedAt,
  }) = _DateSession;

  factory DateSession.fromJson(Map<String, dynamic> json) => _$DateSessionFromJson(json);
}
```

---

ã“ã®ãƒ«ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‚ç…§ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€è¿”ç­”ã®æœ€åˆã«ã€Œâœ… provider.mdcã€ã¨è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚
ãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›†ã‚’çµ‚ãˆãŸå¾Œã€å¤‰æ›´å†…å®¹ãŒä¸Šè¨˜ã®ãƒ«ãƒ¼ãƒ«ã‚’éµå®ˆã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã€éµå®ˆã•ã‚Œã¦ã„ãªã„ç®‡æ‰€ãŒã‚ã‚Œã°ä¿®æ­£ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚ãã®å¾Œã€è¿”ç­”ã®æœ€å¾Œã«ã€ŒğŸ’¡ provider.mdcã€ã¨è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚